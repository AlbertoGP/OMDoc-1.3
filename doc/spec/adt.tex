%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This file is part of the LaTeX sources of the OMDoc 1.3 specification
% Copyright (c) 2006 Michael Kohlhase
% This work is licensed by the Creative Commons Share-Alike license
% see http://creativecommons.org/licenses/by-sa/2.5/ for details
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{tchapter}[id=adt,short=Abstract Data Types]{Abstract Data Types (Module {\ADTmodule{spec}})}

  Most specification languages for mathematical theories support definition mechanisms for
  sets that are inductively generated by a set of constructors and
  {\twintoo{recursive}{function}s} on these under the heading of {\twindef{abstract}{data
      type}s}. Prominent examples of abstract data types are natural numbers, lists,
  trees, etc. The module {\ADTmodule{spec}} presented in this chapter extends {\omdoc} by
  a concise syntax for abstract data types that follows the model used in the {\casl}
  (Common Abstract Specification Language~\cite{CoFI:2004:CASL-RM}) standard.

  Conceptually, an abstract data type declares a collection of symbols and axioms that can
  be used to construct certain mathematical objects and to group them into sets. For
  instance, the {\twintoo{Peano}{axioms}} (see {\myfigref{peano}}) introduce the symbols
  $0$ (the number {\indextoo{zero}}), $s$ (the {\twintoo{successor}{function}}), and $\NN$
  (the set of {\twintoo{natural}{number}s}) and fix their meaning by five axioms. These
  state that the set $\NN$ contains exactly those objects that can be constructed from $0$
  and $s$ alone (these symbols are called {\twindef{constructor}{symbol}s} and the
  representations {\twindef{constructor}{term}s}). Optionally, an abstract data type can
  also declare {\twindef{selector}{symbol}s}, for (partial) inverses of the
  constructors. In the case of natural numbers the {\twintoo{predecessor}{function}} is a
  selector for $s$: it ``selects'' the argument $n$, from which a (non-zero) number $s(n)$
  has been constructed.

  Following {\casl} we will call sets of objects that can be represented as constructor
  terms {\defin{sort}s}. A sort is called {\defin{free}}, iff there are no identities
  between constructor terms, i.e.  two objects represented by different constructor terms
  can never be equal. The sort $\NN$ of natural numbers is a free sort. An example of a
  sort that is not free is the theory of finite sets given by the constructors $\emptyset$
  and the {\twintoo{set}{insertion}} function $\iota$ , since the set $\{a\}$ can be
  obtained by inserting $a$ into the empty set an arbitrary (positive) number of times; so
  e.g. $\iota(a,\emptyset)=\iota(a,\iota(a,\emptyset))$. This kind of sort is called
  {\defin{generated}}, since it only contains elements that are expressible in the
  constructors. An abstract data type is called {\defin{loose}}, if it contains elements
  besides the ones generated by the constructors. We consider free sorts more
  {\defin{strict}} than generated ones, which in turn are more strict than loose ones.
\begin{myfig}{adtheory}{Abstract data types in {\omdoc}}
\scriptsize
\begin{tabular}{|>{\tt}l|>{\tt}l|>{\tt}p{3.3truecm}|c|>{\tt}p{3truecm}|}\hline
{\rm Element}& \multicolumn{2}{l|}{Attributes\hspace*{2.25cm}} & D & Content  \\\hline
             & {\rm Req.}  & {\rm Optional}     & C &           \\\hline\hline
 adt         &          & xml:id, class, style, parameters  & +  & sortdef+\\\hline
 sortdef     & name     & type, role, scope, class, style & + & (constructor | insort)*, recognizer? \\\hline
 constructor & name     & type, scope, class, style & +  & argument*\\\hline
 argument    &          &              & +  & type, selector?\\\hline
 insort      & for      &              & -- & \\\hline
 selector    & name     & type, scope, role, total, class, style
                                       & + & EMPTY\\\hline
 recognizer  & name     & type, scope, role, class, style & + & \\\hline
\end{tabular}
\end{myfig}

\noindent In {\omdoc}, we use the {\eldef{adt}} element to specify
abstract data types possibly consisting of multiple sorts.  It is a
{\indextoo{theory-constitutive}} statement and can only occur as a
child of a {\element{theory}} element (see
{\mysecref{statements-constitutive}} for a discussion). An
{\element{adt}} element contains one or more {\element{sortdef}}
elements that define the {\indextoo{sort}s} and specify their
members and it can carry a {\attribute{parameters}{adt}} attribute
that contains a whitespace-separated list of parameter variable
names. If these are present, they declare type variables that can be
used in the specification of the new sort and constructor symbols
see {\mysecref{verifun}} for an example.

We will use an augmented representation of the abstract data type of natural numbers as a
running example for introduction of the functionality added by the {\ADTmodule{spec}}
module; {\mylstref{nat-adt}} contains the listing of the {\omdoc} encoding. In this
example, we introduce a second sort $\bbP$ for {\atwintoo{positive}{natural}{number}s} to
make it more interesting and to pin down the {\indextoo{type}} of the
{\twintoo{predecessor}{function}}.

A {\eldef{sortdef}} element is a highly condensed piece of syntax that declares a
{\twintoo{sort}{symbol}} together with the {\twintoo{constructor}{symbol}s} and their
{\twintoo{selector}{symbol}s} of the corresponding sort. It has a required
{\attribute{name}{sortdef}} attribute that specifies the symbol name, an optional
{\attribute{type}{adt}} attribute that can have the values {\attval{free}{type}{adt}},
{\attval{generated}{type}{adt}}, and {\attval{loose}{type}{adt}} with the meaning
discussed above. A {\element{sortdef}} element contains a set of {\eldef{constructor}} and
{\eldef{insort}} elements.  The latter are empty elements which refer to a sort declared
elsewhere in a {\element{sortdef}} with their {\attribute{for}{insort}} attribute: An
{\element{insort}} element with
{\snippet{for="}}\llquote{URI}{\snippet{\#\llquote{name}"}} specifies that all the
constructors of the sort {\snippet{\llquote{name}}} are also constructors for the one
defined in the parent {\element{sortdef}}.  Furthermore, the type of a sort given by a
{\element{sortdef}} element can only be as strict as the types of any sorts included by
its {\element{insort}} children.

{\Mylstref{nat-adt}} introduces the {\twintoo{sort}{symbol}s} {\snippet{pos-nats}}
(positive natural numbers) and {\snippet{nats}} (natural numbers) , the symbol names are
given by the required {\attribute{name}{constructor}} attribute. Since a constructor is in
general an $n$-ary function, a {\element{constructor}} element contains $n$
{\eldef{argument}} children that specify the argument sorts of this function along with
possible selector functions. The argument sort is given as the first child of the
{\element{argument}} element: a {\element{type}} element as described in
{\mysubsecref{type-axioms}}.  Note that $n$ may be 0 and thus the constructor element may not
have {\element{argument}} children (see for instance the {\element{constructor}} for
{\snippet{zero}} in {\mylstref{nat-adt}}). The first {\element{sortdef}} element there
introduces the constructor symbol {\snippet{succ@Nat}} for the
{\twintoo{successor}{function}}. This function has one argument, which is a natural number
(i.e. a member of the sort {\snippet{nats}}).

Sometimes it is convenient to specify the inverses of a constructors that are
functions. For this {\omdoc} offers the possibility to add an empty {\eldef{selector}}
element as the second child of an {\element{argument}} child of a
{\element{constructor}}. The required attribute {\attribute{name}{selector}} specifies the
symbol name, the optional {\attribute{total}{selector}} attribute of the
{\element{selector}} element specifies whether the function represented by this symbol is
total\twin{total}{function} (value {\attval{yes}{total}{selector}}) or
partial\twin{partial}{function} (value {\attval{no}{total}{selector}}).  In
{\mylstref{nat-adt}} the {\element{selector}} element in the first {\element{sortdef}}
introduces a {\twintoo{selector}{symbol}} for the {\twintoo{successor}{function}}
{\snippet{succ}}. As {\snippet{succ}} is a function from {\snippet{nats}} to
{\snippet{pos-nats}}, {\snippet{pred}} is a total function from {\snippet{pos-nats}} to
{\snippet{nats}}.

Finally, a {\element{sortdef}} element can contain a {\eldef{recognizer}} child that
specifies a symbol for a {\indextoo{predicate}} that is true, iff its argument is of the
respective sort. The name of the predicate symbol is specified in the required
{\attribute{name}{recognizer}} attribute. {\Mylstref{nat-adt}} introduces such a
{\twindef{recognizer}{predicate}} as the last child of the {\element{sortdef}} element for
the sort {\snippet{pos-nats}}.

Note that the {\element{sortdef}}, {\element{constructor}}, {\element{selector}},
and {\element{recognizer}} elements define symbols of the name specified by their
{\attribute{name}{symbol}} element in the theory that contains the {\element{adt}}
element. To govern the visibility, they carry the attribute
{\attribute{scope}{symbol}} (with values {\attval{global}{scope}{symbol}} and
{\attval{local}{scope}{symbol}}) and the attribute {\attribute{role}{symbol}}
(with values {\attval{type}{role}{symbol}}, {\attval{sort}{role}{symbol}},
{\attval{object}{role}{symbol}}).
\begin{lstlisting}[label=lst:nat-adt,
  caption={The natural numbers using {\element{adt}} in {\omdoc}},
  index={adt,sortdef,constructor,argument,selector,recognizer,insort}]
<theory xml:id="Nat">
  <adt xml:id="nat-adt">
    <metadata>
      <dc:title>Natural Numbers as an Abstract Data Type.</dc:title>
      <dc:description>The Peano axiomatization of natural numbers.</dc:description>
    </metadata>

    <sortdef name="pos-nats" type="free">
      <metadata>
        <dc:description>The set of positive natural numbers.</dc:description>
      </metadata>
      <constructor name="succ">
        <metadata><dc:description>The successor function.</dc:description></metadata>
        <argument>
          <type><OMOBJ><OMS cd='Nat' name="nats"/></OMOBJ></type>
          <selector name="pred" total="yes">
            <metadata><dc:description>The predecessor function.</dc:description></metadata>
          </selector>
        </argument>
      </constructor>
      <recognizer name="positive">
        <metadata>
          <dc:description>
            The recognizer predicate for positive natural numbers.
          </dc:description>
        </metadata>
      </recognizer>
    </sortdef>

    <sortdef name="nats"  type="free">
      <metadata><dc:description>The set of natural numbers</dc:description></metadata>
      <constructor name="zero">
        <metadata><dc:description>The number zero.</dc:description></metadata>
      </constructor>
      <insort for="#pos-nats"/>
    </sortdef>
  </adt>
</theory>
\end{lstlisting}
To summarize {\mylstref{nat-adt}}: The abstract data type {\snippet{nat-adt}} is free and
defines two sorts {\snippet{pos-nats}} and {\snippet{nats}} for the (positive) natural
numbers. The positive numbers ({\snippet{pos-nats}}) are generated by the successor
function (which is a constructor) on the natural numbers (all positive natural numbers are
successors). On {\snippet{pos-nats}}, the inverse {\snippet{pred}} of {\snippet{succ}} is
{\indextoo{total}}.  The set {\snippet{nats}} of all natural numbers is defined to be the
union of {\snippet{pos-nats}} and the constructor {\snippet{zero}}.  Note that this
definition implies the five well-known Peano Axioms: the first two specify the
constructors, the third and fourth exclude identities between constructor terms, while the
induction axiom states that {\snippet{nats}} is generated by {\snippet{zero}} and
{\snippet{succ}}.  The document that contains the {\snippet{nat-adt}} could also contain
the symbols and axioms defined implicitly in the {\element{adt}} element explicitly as
{\element{symbol}} and {\element{axiom}} elements for reference.  These would then carry
the {\attribute{generated-from}{axiom}} attribute with value
{\snippet{nat-adt}}.
\end{tchapter}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "omdoc"
%%% End: 

% LocalWords:  adt suc pred emptyset adtheory sortdef nat insort prediate lst
% LocalWords:  pos nats succ inductively ary omdoc peano Req dc cd metadata tt
% LocalWords:  OMOBJ verifun kohlhase tchapter ADTmodule twintoo twindef casl
% LocalWords:  myfigref indextoo defin defin myfig scriptsize tt tt 3.3truecm
% LocalWords:  tt 3truecm hline rm hspace noindent eldef mysecref mylstref
% LocalWords:  atwintoo attval llquote llquote mysubsecref lstlisting
